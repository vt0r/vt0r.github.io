<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="SALVATORE LAMENDOLA (vt0r)"><meta name=description content="UPDATE: 2019-01-30 - Added TLSv1.3 recommend ciphers. Also added another XSS prevention header.
 Have you seen the recent (and not so recent) OpenSSL/TLS protocol vulnerabilities, and are you worried about securing connections to the Nginx servers you manage?
I&rsquo;m going to assume you answered &ldquo;yes&rdquo; to that question, as it&rsquo;s unlikely you&rsquo;d end up on this page otherwise. The whole purpose of this post is to share some high-security SSL configuration info for Nginx, so you&rsquo;ve come to the right place."><meta property="og:title" content="Recommended Nginx SSL/TLS Settings"><meta property="og:description" content="UPDATE: 2019-01-30 - Added TLSv1.3 recommend ciphers. Also added another XSS prevention header.
 Have you seen the recent (and not so recent) OpenSSL/TLS protocol vulnerabilities, and are you worried about securing connections to the Nginx servers you manage?
I&rsquo;m going to assume you answered &ldquo;yes&rdquo; to that question, as it&rsquo;s unlikely you&rsquo;d end up on this page otherwise. The whole purpose of this post is to share some high-security SSL configuration info for Nginx, so you&rsquo;ve come to the right place."><meta property="og:type" content="article"><meta property="og:url" content="https://lamendo.la/2014/06/06/recommended-nginx-ssl-settings/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2014-06-06T16:24:10+00:00"><meta property="article:modified_time" content="2014-06-06T16:24:10+00:00"><title>Recommended Nginx SSL/TLS Settings</title><link rel=canonical href=https://lamendo.la/2014/06/06/recommended-nginx-ssl-settings/><link rel=preload href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Source+Sans+Pro:400&display=swap" as=style onload="this.onload=null,this.rel='stylesheet'"><link rel=stylesheet href=/css/reset.css><link rel=preload href=/css/pygments.css as=style onload="this.onload=null,this.rel='stylesheet'"><link rel=stylesheet href=/css/main.css><link rel="shortcut icon" href=/images/favicon.ico></head><body lang=en><section class=header><div class=container><div class=content><a href=/><img class=avatar src=/images/avatar@2x.png srcset="https://lamendo.la/images/avatar@2x.png 1x"></a>
<a href=/><div class=name>SALVATORE LAMENDOLA (vt0r)</div></a><nav><ul><li class=nav-><a href=https://lamendo.la/about/><span>About</span></a></li><li class=nav-blog><a href=https://lamendo.la/blog/><span>Blog</span></a></li><li class=nav-><a href=https://ip.1a4.fr/ target=_blank rel=noopener><span>What's my IP?</span></a></li><li class=nav-><a href=https://1a4.fr/ target=_blank rel=noopener><span>Encrypted Pastebin</span></a></li></ul></nav></div></div></section><section class=icons><div class=container><div class=content><a href=https://github.com/vt0r target=_blank rel=noopener><img class=icon src=/img/github.svg alt=github></a>
<a href=https://www.linkedin.com/in/salvatorelamendola target=_blank rel=noopener><img class=icon src=/img/linkedin.svg alt=linkedin></a>
<a href=mailto:salvatore[at@@]lamendo[dot..]la><img class=icon src=/img/email.svg alt=email></a></div></div></section><section class="main post non-narrow zero-top-spacing"><div class=container><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Recommended Nginx SSL/TLS Settings</div><div class=initials><a href=https://lamendo.la></a></div></div><div class=meta><div class=date title="Fri Jun 6 2014 16:24:10 UTC">Jun 6, 2014</div><div class=reading-time><div class=middot></div>2 minutes read</div></div></div><div class=markdown><p><strong>UPDATE: 2019-01-30</strong> - Added TLSv1.3 recommend ciphers. Also added another XSS prevention header.</p><hr><p>Have you seen the recent (and not so recent) OpenSSL/TLS protocol vulnerabilities, and are you worried about securing connections to the Nginx servers you manage?</p><p>I&rsquo;m going to assume you answered &ldquo;yes&rdquo; to that question, as it&rsquo;s unlikely you&rsquo;d end up on this page otherwise. The whole purpose of this post is to share some high-security SSL configuration info for Nginx, so you&rsquo;ve come to the right place.</p><p><strong>DISCLAIMER: YOU SHOULD NOT TRUST ME OR BLINDLY COPY AND PASTE MY CONFIGURATION INTO YOUR NGINX CONFIGURATION FILE WITHOUT UNDERSTANDING WHAT EACH OPTION DOES AND WHY EACH CONFIGURATION VALUE WAS CHOSEN. CONSIDER YOURSELF AND ANY ANIMALS HARMED BY USING MY CONFIGURATION SUFFICIENTLY WARNED</strong></p><p>Here is an example configuration template that should support <em>most</em> browsers currently in use today, while preferring very high levels of security on modern browsers, and effectively mitigating most older/newer attacks:</p><div class=highlight><pre class=chroma><code class=language-nginx data-lang=nginx><span class=c1>## HTTPS globals
</span><span class=c1></span><span class=k>ssl_protocols</span>             <span class=s>TLSv1.2</span><span class=p>;</span>
<span class=c1># Comment the above line and uncomment
</span><span class=c1># below one for nginx versions &gt;= 1.13.0
</span><span class=c1>#ssl_protocols             TLSv1.2 TLSv1.3;
</span><span class=c1></span><span class=k>ssl_ciphers</span>               <span class=s>ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384</span><span class=p>;</span>
<span class=c1># Comment the above line and uncomment
</span><span class=c1># below one for OpenSSL versions &gt;= 1.1.1
</span><span class=c1>#ssl_ciphers               TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256;
</span><span class=c1></span><span class=k>ssl_prefer_server_ciphers</span> <span class=no>on</span><span class=p>;</span>
<span class=k>ssl_dhparam</span>               <span class=s>/path/to/dh4096.pem</span><span class=p>;</span> <span class=c1># &gt;2048-bits recommended
</span><span class=c1></span><span class=k>ssl_session_cache</span>         <span class=s>shared:SSL:10m</span><span class=p>;</span>
<span class=k>ssl_session_timeout</span>       <span class=mi>10m</span><span class=p>;</span>
<span class=k>ssl_session_tickets</span>       <span class=no>off</span><span class=p>;</span>           <span class=c1># Requires nginx &gt;= 1.5.9
</span><span class=c1></span><span class=k>ssl_ecdh_curve</span>            <span class=s>secp384r1</span><span class=p>;</span>     <span class=c1># Requires nginx &gt;= 1.1.0
</span><span class=c1></span><span class=k>resolver</span>                  <span class=mi>1</span><span class=s>.1.1.1</span> <span class=mi>4</span><span class=s>.2.2.1</span> <span class=s>valid=300s</span><span class=p>;</span>
<span class=k>resolver_timeout</span>          <span class=s>5s</span><span class=p>;</span>
<span class=k>ssl_stapling</span>              <span class=no>on</span><span class=p>;</span>            <span class=c1># Requires nginx &gt;= 1.3.7
</span><span class=c1></span><span class=k>ssl_stapling_verify</span>       <span class=no>on</span><span class=p>;</span>            <span class=c1># Requires nginx &gt;= 1.3.7
</span><span class=c1></span>
<span class=c1>## Headers to add inside server blocks
</span><span class=c1></span><span class=k>add_header</span> <span class=s>Strict-Transport-Security</span> <span class=s>&#34;max-age=31536000&#34;</span><span class=p>;</span>
<span class=c1># Add &#34;; includeSubdomains&#34; to the line above if all
</span><span class=c1># subdomains are secured with TLS.
</span><span class=c1></span><span class=k>add_header</span> <span class=s>X-Frame-Options</span> <span class=s>DENY</span><span class=p>;</span>
<span class=k>add_header</span> <span class=s>X-Content-Type-Options</span> <span class=s>nosniff</span><span class=p>;</span>
<span class=k>add_header</span> <span class=s>X-XSS-Protection</span> <span class=s>&#34;1</span><span class=p>;</span> <span class=k>mode=block&#34;</span><span class=p>;</span>
</code></pre></div><p>As you can verify by <a href="https://www.ssllabs.com/ssltest/analyze.html?d=1a4.fr">checking 1a4.fr on the SSL Labs test site</a>, these configuration options, combined with the latest stable versions of OpenSSL and Nginx, score an A+ while still allowing nearly all modern browsers that support TLS1.2 and up (and ECDH) to connect.</p><p>Some of the above options will not work in older versions of Nginx, and they&rsquo;ve been marked with comments to give an idea of which versions are capable of using them.</p><p>Please feel free to send me any comments you may have on possible improvements to the configuration above.</p><br><p class=back-to-posts><a href=/blog>Back to posts</a></p></div><br><div class=disqus></div></div></div></section></body></html>